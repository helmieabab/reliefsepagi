<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>Sistem Relief SK Kepangian - FINAL MASTER</title>
    <style>
        :root { --primary: #1e3a8a; --accent: #2563eb; --danger: #dc2626; --success: #059669; }
        body { font-family: 'Inter', sans-serif; background: #f8fafc; padding: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        
        /* Header Layout */
        .header { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-bottom: 4px double var(--primary); 
            padding-bottom: 15px; 
            margin-bottom: 25px;
            gap: 25px;
        }
        .logo-sekolah { width: 90px; height: auto; }
        .header-text { text-align: center; }

        .no-print { background: #f1f5f9; padding: 25px; border-radius: 10px; border: 1px solid #cbd5e1; margin-bottom: 30px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr 1.5fr 1fr; gap: 20px; margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; }
        label { font-weight: bold; font-size: 13px; margin-bottom: 8px; color: #1e3a8a; text-transform: uppercase; }
        select, input { padding: 12px; border-radius: 8px; border: 1px solid #cbd5e1; background: white; font-size: 14px; }
        
        .btn { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-add { background: var(--accent); color: white; width: 100%; height: 45px; margin-top: auto; }
        .btn-jana { background: var(--primary); color: white; width: 100%; font-size: 16px; letter-spacing: 1px; }
        .btn-print { background: var(--success); color: white; width: 100%; margin-top: 20px; display: none; font-size: 16px; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #1e3a8a; color: white; border: 1px solid #000; padding: 12px; font-size: 13px; }
        td { border: 1px solid #000; padding: 12px; text-align: center; font-size: 14px; }
        .guru-ganti { font-weight: 800; color: #1e40af; background: #eff6ff; }
        .status-free { font-size: 10px; color: var(--success); font-weight: bold; display: block; margin-top: 3px; }
        .warning { color: white; background: var(--danger); font-weight: bold; }
        
        #statusCuti { margin-top: 15px; font-weight: bold; color: var(--danger); padding: 12px; background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; display: none; }
        
        @media print { 
            .no-print, .btn-print { display: none !important; } 
            .container { box-shadow: none; border: none; width: 100%; padding: 0; }
            body { background: white; padding: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://i.postimg.cc/d0ZY5BPK/LOGO-SK-KEPANGIAN.jpg" alt="Logo SK Kepangian" class="logo-sekolah">
        
        <div class="header-text">
            <h1 style="margin:0; color: var(--primary);">SK KEPANGIAN RANAU (XBA5458)</h1>
            <p style="margin:5px 0; font-weight:bold; text-decoration: underline;">PENYATA PENYEDIAAN GURU GANTI (RELIEF)</p>
        </div>
    </div>

    <div class="no-print">
        <div class="input-grid">
            <div class="input-group">
                <label>Pilih Tarikh</label>
                <input type="date" id="inpTkh" onchange="autoHari()">
            </div>
            <div class="input-group">
                <label>Hari (Auto)</label>
                <input type="text" id="selHari" readonly style="background: #e2e8f0; font-weight: bold;">
            </div>
            <div class="input-group">
                <label>Alasan Tidak Hadir</label>
                <select id="selAlasan">
                    <option value="Cuti Sakit (MC)">Cuti Sakit (MC)</option>
                    <option value="Urusan Rasmi">Urusan Rasmi</option>
                    <option value="Cuti Rehat Khas (CRK)">Cuti Rehat Khas (CRK)</option>
                    <option value="Kursus / Bengkel">Kursus / Bengkel</option>
                    <option value="Temujanji Doktor">Temujanji Doktor</option>
                    <option value="Kecemasan / Peribadi">Kecemasan / Peribadi</option>
                </select>
            </div>
            <div class="input-group">
                <label>Guru Tiada</label>
                <select id="selGuru">
                    <option value="SANISAH">SANISAH SUZIELA</option><option value="RIMEH">RIMEH GIWOD</option>
                    <option value="MATRAUZEY">MATRAUZEY LUJI</option><option value="SHAMRAN">SHAMRAN TAHIR</option>
                    <option value="HELMIE">HELMIE ABAB</option><option value="TRECY">TRECY BARBARA</option>
                    <option value="QUDDUS">QUDDUS ROSLI</option><option value="SYAFIQ">USTAZ SYAFIQ</option>
                    <option value="SHAMSIAH">SHAMSIAH FAUZI</option><option value="ANDREW">ANDREW ARID</option>
                    <option value="MARIANI">MARIANI SUBIN</option><option value="JOANNA">JOANNA (GB)</option>
                </select>
            </div>
        </div>
        <button class="btn btn-add" onclick="tambahCuti()">+ TAMBAH GURU KE SENARAI</button>
        <div id="statusCuti"></div>
        <button class="btn btn-jana" onclick="janaRelief()" style="margin-top:15px;">‚ö° JANA JADUAL RELIEF</button>
    </div>

    <div id="printArea">
        <div id="metaInfo" style="margin-bottom: 10px; font-weight: bold; display: none;">
            TARIKH: <span id="outTkh"></span> | HARI: <span id="outHari"></span>
        </div>
        <table id="tblRelief" style="display:none;">
            <thead>
                <tr>
                    <th width="15%">MASA & WAKTU</th>
                    <th width="30%">GURU TIADA (ALASAN)</th>
                    <th width="20%">KELAS / SUBJEK</th>
                    <th width="35%">GURU PENGGANTI</th>
                </tr>
            </thead>
            <tbody id="resBody"></tbody>
        </table>
    </div>

    <button class="btn btn-print" id="btnPrint" onclick="window.print()">üñ®Ô∏è CETAK JADUAL RELIEF</button>
</div>

<script>
const slotMasa = {
    1: "07:20 - 07:50", 2: "07:50 - 08:20", 3: "08:20 - 08:50", 4: "08:50 - 09:20",
    5: "09:20 - 09:50", 6: "09:50 - 10:20", 7: "10:40 - 11:10", 8: "11:10 - 11:40",
    9: "11:40 - 12:10", 10: "12:10 - 12:40", 11: "12:40 - 13:10"
};

const db = {
    "Isnin": {
        "JOANNA": {1:"PER"}, "QUDDUS": {1:"PER", 4:"M3 T5", 5:"M3 T5", 7:"M3 T1", 8:"M3 T1"},
        "SYAFIQ": {1:"PER", 2:"PAI T6", 3:"PAI T6", 4:"PAI T1", 5:"PAI T1", 7:"PAI PRA", 10:"TAS", 11:"TAS"},
        "TRECY": {1:"PER", 2:"BI T4", 3:"BI T4", 5:"BI T6", 6:"BI T6", 7:"BI T6", 8:"BI T4", 9:"BI T4"},
        "SHAMSIAH": {1:"PER", 2:"SN T1", 3:"SN T1", 4:"PM T1", 5:"PM T1", 9:"SN T1", 10:"RBT T6", 11:"RBT T6"},
        "SHAMRAN": {1:"PER", 2:"PM T6", 3:"PM T6", 4:"PK T4", 6:"PK T3"},
        "SANISAH": {1:"PER", 7:"BM T3", 10:"PSV T5", 11:"PSV T5"},
        "HELMIE": {1:"PER", 4:"M3 T3", 5:"M3 T3", 6:"PK T5", 8:"M3 T2", 9:"M3 T2"},
        "MATRAUZEY": {1:"PER", 2:"PK T2", 4:"BKD T6", 6:"PK T1", 8:"BKD T6", 9:"SEJ T4", 10:"SEJ T4"},
        "MARIANI": {1:"PER", 2:"BI T5", 3:"BI T5", 5:"BI T2", 6:"BI T2", 7:"BI T5"},
        "ANDREW": {1:"PER", 2:"BKD T3", 5:"BM T4", 6:"BM T4", 7:"BM T4", 9:"BKD T3"},
        "RIMEH": {1:"PER", 3:"BM T2", 4:"BM T2", 7:"BM T2", 8:"BM T5", 9:"BM T5"}
    },
    "Selasa": {
        "JOANNA": {10:"PM T4", 11:"PM T4"}, "QUDDUS": {1:"PM T3", 3:"M3 T1", 4:"M3 T1", 5:"BI T3", 6:"BI T3", 9:"M3 T5", 10:"M3 T5"},
        "SYAFIQ": {1:"PAI T3", 2:"PAI T3", 3:"PAI T2", 4:"PAI T2", 5:"PAI T5", 6:"PAI T5", 10:"PAI T4", 11:"PAI T4"},
        "TRECY": {1:"BI T1", 5:"BI T4", 6:"BI T4", 7:"BI T4", 9:"BI T1", 10:"BI T1"},
        "SHAMSIAH": {3:"M3 T4", 4:"M3 T4", 8:"PSV T4", 9:"PSV T4"},
        "SHAMRAN": {2:"PJ T4", 3:"PJ T3", 5:"PM T5", 6:"PM T5", 9:"M3 T6", 10:"M3 T6"},
        "HELMIE": {1:"PJ T6", 2:"PJ T5", 3:"PM T2", 7:"M3 T3", 8:"M3 T3"},
        "MATRAUZEY": {1:"PJ T2", 2:"PJ T1", 5:"SN T6", 6:"SN T6", 7:"SN T6"},
        "SANISAH": {4:"BM T3", 5:"BM T1", 6:"BM T1", 7:"BM T1", 8:"BM T1", 9:"BM T3"},
        "MARIANI": {2:"BI T2", 3:"BI T5", 4:"BI T5", 9:"BI T2", 10:"BI T2", 11:"MUZ T5"},
        "ANDREW": {1:"BKD T5", 3:"BM T6", 4:"BM T6", 7:"BKD T5", 8:"BKD T5", 11:"BM T6"},
        "RIMEH": {1:"MK T4", 2:"MK T6", 5:"BM T2", 6:"BM T2", 7:"BM T2", 8:"MK T2"}
    },
    "Rabu": {
        "JOANNA": {7:"PM T4", 8:"PM T4"}, "QUDDUS": {1:"BI T3", 2:"BI T3", 5:"PM T3", 6:"PM T3", 7:"MK T1", 9:"BI T3", 10:"BI T3"},
        "SYAFIQ": {1:"PAI T6", 2:"PAI T6", 3:"PAI T2", 4:"PAI T2", 5:"PAI T3", 6:"PAI T3", 7:"PAI T4", 8:"PAI T4", 9:"PAI T5", 10:"PAI T5"},
        "TRECY": {1:"BI T1", 2:"BI T1", 7:"BI T6", 8:"BI T6", 9:"BI T1", 10:"BI T1"},
        "SHAMSIAH": {1:"M3 T4", 2:"M3 T4", 5:"SN T2", 6:"SN T2", 7:"SN T2"},
        "SHAMRAN": {1:"PM T6", 2:"PM T6", 3:"M3 T6", 4:"M3 T6", 9:"PM T5", 10:"PM T5"},
        "HELMIE": {3:"PM T2", 4:"PM T2", 5:"RBT T5", 6:"RBT T5", 9:"RBT T4", 10:"RBT T4"},
        "MATRAUZEY": {1:"BKD T2", 2:"BKD T2", 3:"SN T4", 4:"SN T4", 8:"BKD T2"},
        "SANISAH": {3:"BM T3", 4:"BM T3", 5:"BM T1", 8:"BM T3"},
        "MARIANI": {3:"SEJ T5", 4:"SEJ T5", 5:"SEJ T6", 6:"SEJ T6", 7:"MUZ T3"},
        "ANDREW": {3:"BKD T1", 4:"BKD T1", 5:"BM T4", 6:"BM T4", 8:"BKD T1", 9:"BM T6", 10:"BM T6"},
        "RIMEH": {1:"BM T5", 2:"BM T5", 7:"BM T5", 8:"BM T5", 9:"BM T2", 10:"BM T2"}
    },
    "Khamis": {
        "JOANNA": {2:"PM T4", 3:"PM T4"}, "QUDDUS": {2:"M3 T1", 3:"M3 T1", 5:"BI T3", 6:"BI T3", 9:"M3 T5", 10:"M3 T5"},
        "SYAFIQ": {2:"PAI T4", 3:"PAI T4", 5:"PAI PRA", 6:"PAI PRA", 7:"PAI T1", 8:"PAI T1", 9:"PAI T6", 10:"TAS", 11:"TAS"},
        "TRECY": {2:"BI T6", 3:"BI T6", 4:"BI T1", 5:"BI T1", 9:"BI T1", 10:"BI T1"},
        "SHAMSIAH": {1:"SN T3", 5:"M3 T4", 6:"M3 T4", 7:"PM T1", 8:"PM T1", 9:"SN T3"},
        "SHAMRAN": {1:"PJ T4", 2:"PJ T3", 7:"PSV T6", 8:"PSV T6", 9:"PM T6", 10:"PM T6"},
        "HELMIE": {1:"PJ T6", 3:"PJ T5", 4:"PK T6", 5:"M3 T2", 6:"M3 T2", 7:"M3 T2", 8:"M3 T2"},
        "MATRAUZEY": {1:"PJ T1", 2:"PJ T2", 4:"BKD T4", 5:"SN T5", 6:"SN T5", 9:"BKD T4"},
        "SANISAH": {3:"PSV T3", 4:"PSV T3", 5:"BM T1", 6:"BM T1", 7:"BM T3"},
        "MARIANI": {1:"BI T2", 4:"BI T5", 5:"BI T5", 7:"BI T5", 8:"BI T5", 9:"BI T2", 10:"BI T2"},
        "ANDREW": {5:"BM T6", 6:"BM T6", 7:"BM T4", 8:"BM T4"},
        "RIMEH": {1:"BM T5", 2:"BM T5", 3:"BM T2", 4:"BM T2"}
    },
    "Jumaat": {
        "JOANNA": {}, "QUDDUS": {1:"BI T3", 2:"BI T3", 3:"M3 T1", 4:"M3 T1", 5:"PM T3", 6:"PM T3"},
        "SYAFIQ": {1:"PAI T2", 2:"PAI T2", 3:"PAI T1", 4:"PAI T1", 5:"PAI T3", 6:"PAI T3", 7:"PAI T5"},
        "TRECY": {1:"BI T4", 2:"BI T4", 3:"BI T6", 4:"BI T6", 7:"BI T4", 8:"BI T6"},
        "SHAMSIAH": {3:"PM T1", 4:"PM T1", 5:"PSV T2", 6:"PSV T2"},
        "SHAMRAN": {5:"M3 T6", 6:"M3 T6", 7:"PM T5", 8:"PM T5"},
        "SANISAH": {1:"BM T1", 2:"BM T1", 3:"BM T3", 4:"BM T3", 7:"BM T1"},
        "HELMIE": {1:"PM T2", 2:"PM T2", 7:"M3 T3", 8:"M3 T3"},
        "MATRAUZEY": {3:"SN T5", 4:"SN T5", 5:"SN T5", 6:"SN T4"},
        "MARIANI": {1:"BI T5", 2:"BI T5", 5:"PSV T1", 6:"PSV T1", 7:"BI T2", 8:"BI T2"},
        "ANDREW": {1:"BM T6", 2:"BM T6", 3:"BM T4", 4:"BM T4", 7:"BM T6", 8:"BM T4"},
        "RIMEH": {3:"BM T2", 4:"BM T2", 5:"BM T5", 6:"BM T5"}
    }
};

let cutiList = [];

function autoHari() {
    const tarikh = new Date(document.getElementById('inpTkh').value);
    const senaraiHari = ["Ahad", "Isnin", "Selasa", "Rabu", "Khamis", "Jumaat", "Sabtu"];
    const hariTerpilih = senaraiHari[tarikh.getDay()];
    
    if(hariTerpilih === "Sabtu" || hariTerpilih === "Ahad") {
        alert("Sila pilih hari sekolah (Isnin - Jumaat)");
        document.getElementById('selHari').value = "";
    } else {
        document.getElementById('selHari').value = hariTerpilih;
    }
}

function tambahCuti() {
    const g = document.getElementById('selGuru').value;
    const a = document.getElementById('selAlasan').value;
    if(!cutiList.find(x => x.nama === g)) {
        cutiList.push({ nama: g, alasan: a });
        const statusDiv = document.getElementById('statusCuti');
        statusDiv.style.display = "block";
        statusDiv.innerHTML = "GURU TERLIBAT: " + cutiList.map(x => `${x.nama} (${x.alasan})`).join(", ");
    }
}

function janaRelief() {
    const hari = document.getElementById('selHari').value;
    const tkh = document.getElementById('inpTkh').value;
    if(!hari || !tkh) { alert("Sila isi tarikh!"); return; }
    if(cutiList.length === 0) { alert("Tambah guru tiada!"); return; }

    const body = document.getElementById('resBody');
    body.innerHTML = "";
    let usedInSlot = {}; 

    for(let m=1; m<=11; m++) {
        usedInSlot[m] = [];
        cutiList.forEach(gc => {
            if(db[hari][gc.nama] && db[hari][gc.nama][m]) {
                const ganti = cariGantiPintar(hari, m, usedInSlot[m]);
                body.innerHTML += `<tr>
                    <td><b>MASA ${m}</b><br><small>${slotMasa[m]}</small></td>
                    <td><b>${gc.nama}</b><br><small>(${gc.alasan})</small></td>
                    <td><b>${db[hari][gc.nama][m]}</b></td>
                    <td class="${ganti.includes('TIADA') ? 'warning' : 'guru-ganti'}">
                        ${ganti}
                        ${ganti.includes('TIADA') ? '' : '<span class="status-free">(STATUS: FREE)</span>'}
                    </td>
                </tr>`;
            }
        });
    }

    document.getElementById('outTkh').innerText = tkh.split("-").reverse().join("/");
    document.getElementById('outHari').innerText = hari.toUpperCase();
    document.getElementById('metaInfo').style.display = "block";
    document.getElementById('tblRelief').style.display = "table";
    document.getElementById('btnPrint').style.display = "block";
}

function cariGantiPintar(hari, masa, taken) {
    const semuaGuru = Object.keys(db[hari]);
    const calonFree = semuaGuru.filter(g => {
        const isCuti = cutiList.some(x => x.nama === g);
        const adaKelas = db[hari][g][masa] !== undefined;
        const dahKenaRelief = taken.includes(g);
        return !isCuti && !adaKelas && !dahKenaRelief;
    });

    if(calonFree.length === 0) return "‚ö†Ô∏è TIADA GURU KOSONG";

    let pilihan;
    if(calonFree.length > 1 && calonFree.includes("JOANNA")) {
        const tanpaGB = calonFree.filter(x => x !== "JOANNA");
        pilihan = tanpaGB[Math.floor(Math.random() * tanpaGB.length)];
    } else {
        pilihan = calonFree[Math.floor(Math.random() * calonFree.length)];
    }

    taken.push(pilihan);
    return pilihan;
}
</script>
</body>
</html>